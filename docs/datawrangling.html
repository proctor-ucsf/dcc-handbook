<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Data Wrangling | Proctor Foundation Data Science Handbook</title>
  <meta name="description" content="This is a handbook to help summarize best practices in data science among team members at the Francis I. Proctor Foundation." />
  <meta name="generator" content="bookdown 0.15 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Data Wrangling | Proctor Foundation Data Science Handbook" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a handbook to help summarize best practices in data science among team members at the Francis I. Proctor Foundation." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Data Wrangling | Proctor Foundation Data Science Handbook" />
  
  <meta name="twitter:description" content="This is a handbook to help summarize best practices in data science among team members at the Francis I. Proctor Foundation." />
  

<meta name="author" content="Contributors: Ben Arnold, Jade Benjamin-Chung, Kunal Mishra, Anna Nguyen, Nolan Pokpongkiat, Stephanie Djajadi, Eric Kim (many from UC Berkeley in addition to Proctor)" />


<meta name="date" content="2019-12-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="codingstyle.html"/>
<link rel="next" href="bigdata.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />












<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Proctor Data Science Handbook</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome!</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction: Work Flow and Reproducible Analyses</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#workflow"><i class="fa fa-check"></i><b>1.1</b> Workflow</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#reproducibility"><i class="fa fa-check"></i><b>1.2</b> Reproducibility</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#automation"><i class="fa fa-check"></i><b>1.3</b> Automation</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="workflows.html"><a href="workflows.html"><i class="fa fa-check"></i><b>2</b> Workflows</a></li>
<li class="chapter" data-level="3" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html"><i class="fa fa-check"></i><b>3</b> Directory Structure and Code Repositories</a><ul>
<li class="chapter" data-level="3.1" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#small-and-large-projects"><i class="fa fa-check"></i><b>3.1</b> Small and large projects</a></li>
<li class="chapter" data-level="3.2" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#directory-structure"><i class="fa fa-check"></i><b>3.2</b> Directory Structure</a><ul>
<li class="chapter" data-level="3.2.1" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#first-level-data-and-analyses"><i class="fa fa-check"></i><b>3.2.1</b> First level: data and analyses</a></li>
<li class="chapter" data-level="3.2.2" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#second-level-data"><i class="fa fa-check"></i><b>3.2.2</b> Second level: data</a></li>
<li class="chapter" data-level="3.2.3" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#second-level-analysis"><i class="fa fa-check"></i><b>3.2.3</b> Second level: analysis</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#code-repositories"><i class="fa fa-check"></i><b>3.3</b> Code Repositories</a><ul>
<li class="chapter" data-level="3.3.1" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#rproj-files"><i class="fa fa-check"></i><b>3.3.1</b> <code>.Rproj</code> files</a></li>
<li class="chapter" data-level="3.3.2" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#configuration-config-file"><i class="fa fa-check"></i><b>3.3.2</b> Configuration (‘config’) File</a></li>
<li class="chapter" data-level="3.3.3" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#shared-functions-file"><i class="fa fa-check"></i><b>3.3.3</b> Shared Functions File</a></li>
<li class="chapter" data-level="3.3.4" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#order-files-and-subdirectories"><i class="fa fa-check"></i><b>3.3.4</b> Order Files and Subdirectories</a></li>
<li class="chapter" data-level="3.3.5" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#use-bash-scripts-to-ensure-reproducibility"><i class="fa fa-check"></i><b>3.3.5</b> Use Bash scripts to ensure reproducibility</a></li>
<li class="chapter" data-level="3.3.6" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#alternative-approach-for-code-repos"><i class="fa fa-check"></i><b>3.3.6</b> Alternative approach for code repos</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="codingpractices.html"><a href="codingpractices.html"><i class="fa fa-check"></i><b>4</b> Coding Practices</a><ul>
<li class="chapter" data-level="4.1" data-path="codingpractices.html"><a href="codingpractices.html#organizing-scripts"><i class="fa fa-check"></i><b>4.1</b> Organizing scripts</a></li>
<li class="chapter" data-level="4.2" data-path="codingpractices.html"><a href="codingpractices.html#documenting-your-code"><i class="fa fa-check"></i><b>4.2</b> Documenting your code</a><ul>
<li class="chapter" data-level="4.2.1" data-path="codingpractices.html"><a href="codingpractices.html#file-headers"><i class="fa fa-check"></i><b>4.2.1</b> File headers</a></li>
<li class="chapter" data-level="4.2.2" data-path="codingpractices.html"><a href="codingpractices.html#comments-in-the-body-of-your-script"><i class="fa fa-check"></i><b>4.2.2</b> Comments in the body of your script</a></li>
<li class="chapter" data-level="4.2.3" data-path="codingpractices.html"><a href="codingpractices.html#function-documentation"><i class="fa fa-check"></i><b>4.2.3</b> Function documentation</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="codingpractices.html"><a href="codingpractices.html#object-naming"><i class="fa fa-check"></i><b>4.3</b> Object naming</a></li>
<li class="chapter" data-level="4.4" data-path="codingpractices.html"><a href="codingpractices.html#function-calls"><i class="fa fa-check"></i><b>4.4</b> Function calls</a></li>
<li class="chapter" data-level="4.5" data-path="codingpractices.html"><a href="codingpractices.html#the-here-package"><i class="fa fa-check"></i><b>4.5</b> The <code>here</code> package</a></li>
<li class="chapter" data-level="4.6" data-path="codingpractices.html"><a href="codingpractices.html#tidyverse"><i class="fa fa-check"></i><b>4.6</b> Tidyverse</a></li>
<li class="chapter" data-level="4.7" data-path="codingpractices.html"><a href="codingpractices.html#coding-with-r-and-python"><i class="fa fa-check"></i><b>4.7</b> Coding with R and Python</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="codingstyle.html"><a href="codingstyle.html"><i class="fa fa-check"></i><b>5</b> Coding Style</a><ul>
<li class="chapter" data-level="5.1" data-path="codingstyle.html"><a href="codingstyle.html#line-breaks"><i class="fa fa-check"></i><b>5.1</b> Line breaks</a></li>
<li class="chapter" data-level="5.2" data-path="codingstyle.html"><a href="codingstyle.html#automated-tools-for-style-and-project-workflow"><i class="fa fa-check"></i><b>5.2</b> Automated Tools for Style and Project Workflow</a><ul>
<li class="chapter" data-level="5.2.1" data-path="codingstyle.html"><a href="codingstyle.html#styling"><i class="fa fa-check"></i><b>5.2.1</b> Styling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="datawrangling.html"><a href="datawrangling.html"><i class="fa fa-check"></i><b>6</b> Data Wrangling</a><ul>
<li class="chapter" data-level="6.1" data-path="datawrangling.html"><a href="datawrangling.html#overview"><i class="fa fa-check"></i><b>6.1</b> Overview</a></li>
<li class="chapter" data-level="6.2" data-path="datawrangling.html"><a href="datawrangling.html#cardinal-rule"><i class="fa fa-check"></i><b>6.2</b> Cardinal rule</a></li>
<li class="chapter" data-level="6.3" data-path="datawrangling.html"><a href="datawrangling.html#data-inputoutput-io"><i class="fa fa-check"></i><b>6.3</b> Data input/output (I/O)</a><ul>
<li class="chapter" data-level="6.3.1" data-path="datawrangling.html"><a href="datawrangling.html#excel-files"><i class="fa fa-check"></i><b>6.3.1</b> Excel files</a></li>
<li class="chapter" data-level="6.3.2" data-path="datawrangling.html"><a href="datawrangling.html#rds-vs-.rdata-files"><i class="fa fa-check"></i><b>6.3.2</b> <code>.RDS</code> vs <code>.RData</code> Files</a></li>
<li class="chapter" data-level="6.3.3" data-path="datawrangling.html"><a href="datawrangling.html#csv-files"><i class="fa fa-check"></i><b>6.3.3</b> <code>.CSV</code> Files</a></li>
<li class="chapter" data-level="6.3.4" data-path="datawrangling.html"><a href="datawrangling.html#publishing-public-data"><i class="fa fa-check"></i><b>6.3.4</b> Publishing public data</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="datawrangling.html"><a href="datawrangling.html#documenting-datasets"><i class="fa fa-check"></i><b>6.4</b> Documenting datasets</a></li>
<li class="chapter" data-level="6.5" data-path="datawrangling.html"><a href="datawrangling.html#mapping-data-from-untouched---final"><i class="fa fa-check"></i><b>6.5</b> Mapping data from untouched -&gt; final</a></li>
<li class="chapter" data-level="6.6" data-path="datawrangling.html"><a href="datawrangling.html#relational-data"><i class="fa fa-check"></i><b>6.6</b> Relational data</a></li>
<li class="chapter" data-level="6.7" data-path="datawrangling.html"><a href="datawrangling.html#be-careful-with-joins-merges"><i class="fa fa-check"></i><b>6.7</b> Be careful with joins / merges</a></li>
<li class="chapter" data-level="6.8" data-path="datawrangling.html"><a href="datawrangling.html#reshaping-data"><i class="fa fa-check"></i><b>6.8</b> Reshaping data</a></li>
<li class="chapter" data-level="6.9" data-path="datawrangling.html"><a href="datawrangling.html#data-cleaning"><i class="fa fa-check"></i><b>6.9</b> Data cleaning</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="bigdata.html"><a href="bigdata.html"><i class="fa fa-check"></i><b>7</b> Working with Big Data</a><ul>
<li class="chapter" data-level="7.1" data-path="bigdata.html"><a href="bigdata.html#basics"><i class="fa fa-check"></i><b>7.1</b> Basics</a></li>
<li class="chapter" data-level="7.2" data-path="bigdata.html"><a href="bigdata.html#using-downsampled-data"><i class="fa fa-check"></i><b>7.2</b> Using downsampled data</a></li>
<li class="chapter" data-level="7.3" data-path="bigdata.html"><a href="bigdata.html#big-data-unix"><i class="fa fa-check"></i><b>7.3</b> Unix</a></li>
<li class="chapter" data-level="7.4" data-path="bigdata.html"><a href="bigdata.html#sql-and-dbplyr"><i class="fa fa-check"></i><b>7.4</b> SQL and <code>dbplyr</code></a></li>
<li class="chapter" data-level="7.5" data-path="bigdata.html"><a href="bigdata.html#data.table-and-dtplyr"><i class="fa fa-check"></i><b>7.5</b> <code>data.table</code> and <code>dtplyr</code></a></li>
<li class="chapter" data-level="7.6" data-path="bigdata.html"><a href="bigdata.html#ff-bigmemory-biglm"><i class="fa fa-check"></i><b>7.6</b> <code>ff</code>, <code>bigmemory</code>, <code>biglm</code></a></li>
<li class="chapter" data-level="7.7" data-path="bigdata.html"><a href="bigdata.html#parallel-computing"><i class="fa fa-check"></i><b>7.7</b> Parallel computing</a><ul>
<li class="chapter" data-level="7.7.1" data-path="bigdata.html"><a href="bigdata.html#embarrassingly-parallel-problems"><i class="fa fa-check"></i><b>7.7.1</b> Embarrassingly Parallel Problems</a></li>
<li class="chapter" data-level="7.7.2" data-path="bigdata.html"><a href="bigdata.html#packages"><i class="fa fa-check"></i><b>7.7.2</b> Packages</a></li>
<li class="chapter" data-level="7.7.3" data-path="bigdata.html"><a href="bigdata.html#gpus"><i class="fa fa-check"></i><b>7.7.3</b> GPU’s</a></li>
<li class="chapter" data-level="7.7.4" data-path="bigdata.html"><a href="bigdata.html#the-mapreduce-paradigm"><i class="fa fa-check"></i><b>7.7.4</b> The <em>MapReduce</em> paradigm</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="bigdata.html"><a href="bigdata.html#optimal-rstudio-set-up"><i class="fa fa-check"></i><b>7.8</b> Optimal RStudio set up</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="github.html"><a href="github.html"><i class="fa fa-check"></i><b>8</b> GitHub and Version Control</a><ul>
<li class="chapter" data-level="8.1" data-path="github.html"><a href="github.html#basics-1"><i class="fa fa-check"></i><b>8.1</b> Basics</a></li>
<li class="chapter" data-level="8.2" data-path="github.html"><a href="github.html#git-branching"><i class="fa fa-check"></i><b>8.2</b> Git Branching</a></li>
<li class="chapter" data-level="8.3" data-path="github.html"><a href="github.html#example-workflow"><i class="fa fa-check"></i><b>8.3</b> Example Workflow</a></li>
<li class="chapter" data-level="8.4" data-path="github.html"><a href="github.html#commonly-used-git-commands"><i class="fa fa-check"></i><b>8.4</b> Commonly Used Git Commands</a></li>
<li class="chapter" data-level="8.5" data-path="github.html"><a href="github.html#how-often-should-i-commit"><i class="fa fa-check"></i><b>8.5</b> How often should I commit?</a></li>
<li class="chapter" data-level="8.6" data-path="github.html"><a href="github.html#what-should-be-pushed-to-github"><i class="fa fa-check"></i><b>8.6</b> What should be pushed to Github?</a></li>
<li class="chapter" data-level="8.7" data-path="github.html"><a href="github.html#how-should-i-describe-my-commit"><i class="fa fa-check"></i><b>8.7</b> How should I describe my commit?</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="unix.html"><a href="unix.html"><i class="fa fa-check"></i><b>9</b> UNIX Commands</a><ul>
<li class="chapter" data-level="9.1" data-path="unix.html"><a href="unix.html#environment"><i class="fa fa-check"></i><b>9.1</b> Environment</a></li>
<li class="chapter" data-level="9.2" data-path="unix.html"><a href="unix.html#basics-2"><i class="fa fa-check"></i><b>9.2</b> Basics</a></li>
<li class="chapter" data-level="9.3" data-path="unix.html"><a href="unix.html#syntax-for-both-macwindows"><i class="fa fa-check"></i><b>9.3</b> Syntax for both Mac/Windows</a></li>
<li class="chapter" data-level="9.4" data-path="unix.html"><a href="unix.html#running-bash-scripts"><i class="fa fa-check"></i><b>9.4</b> Running Bash Scripts</a></li>
<li class="chapter" data-level="9.5" data-path="unix.html"><a href="unix.html#running-rscripts-in-windows"><i class="fa fa-check"></i><b>9.5</b> Running Rscripts in Windows</a><ul>
<li class="chapter" data-level="9.5.1" data-path="unix.html"><a href="unix.html#common-mistakes"><i class="fa fa-check"></i><b>9.5.1</b> Common Mistakes</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="unix.html"><a href="unix.html#checking-tasks-and-killing-jobs"><i class="fa fa-check"></i><b>9.6</b> Checking tasks and killing jobs</a></li>
<li class="chapter" data-level="9.7" data-path="unix.html"><a href="unix.html#running-big-jobs"><i class="fa fa-check"></i><b>9.7</b> Running big jobs</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="commcoord.html"><a href="commcoord.html"><i class="fa fa-check"></i><b>10</b> Communication and Coordination</a><ul>
<li class="chapter" data-level="10.1" data-path="commcoord.html"><a href="commcoord.html#slack"><i class="fa fa-check"></i><b>10.1</b> Slack</a></li>
<li class="chapter" data-level="10.2" data-path="commcoord.html"><a href="commcoord.html#email"><i class="fa fa-check"></i><b>10.2</b> Email</a></li>
<li class="chapter" data-level="10.3" data-path="commcoord.html"><a href="commcoord.html#trello"><i class="fa fa-check"></i><b>10.3</b> Trello</a></li>
<li class="chapter" data-level="10.4" data-path="commcoord.html"><a href="commcoord.html#google-drive"><i class="fa fa-check"></i><b>10.4</b> Google Drive</a></li>
<li class="chapter" data-level="10.5" data-path="commcoord.html"><a href="commcoord.html#calendar-meetings"><i class="fa fa-check"></i><b>10.5</b> Calendar / Meetings</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="code-of-conduct.html"><a href="code-of-conduct.html"><i class="fa fa-check"></i><b>11</b> Code of conduct</a><ul>
<li class="chapter" data-level="11.1" data-path="code-of-conduct.html"><a href="code-of-conduct.html#group-culture"><i class="fa fa-check"></i><b>11.1</b> Group culture</a></li>
<li class="chapter" data-level="11.2" data-path="code-of-conduct.html"><a href="code-of-conduct.html#protecting-human-subjects"><i class="fa fa-check"></i><b>11.2</b> Protecting human subjects</a></li>
<li class="chapter" data-level="11.3" data-path="code-of-conduct.html"><a href="code-of-conduct.html#authorship"><i class="fa fa-check"></i><b>11.3</b> Authorship</a></li>
<li class="chapter" data-level="11.4" data-path="code-of-conduct.html"><a href="code-of-conduct.html#work-hours"><i class="fa fa-check"></i><b>11.4</b> Work hours</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>12</b> Additional Resources</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="13" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html"><i class="fa fa-check"></i><b>13</b> Building Automated Markdown Reports</a><ul>
<li class="chapter" data-level="13.1" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html#setting-up-the-markdown"><i class="fa fa-check"></i><b>13.1</b> Setting up the markdown</a><ul>
<li class="chapter" data-level="13.1.1" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html#yaml"><i class="fa fa-check"></i><b>13.1.1</b> YAML</a></li>
<li class="chapter" data-level="13.1.2" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html#directory-structure-1"><i class="fa fa-check"></i><b>13.1.2</b> Directory structure</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html#automating-the-data-export-process"><i class="fa fa-check"></i><b>13.2</b> Automating the data export process</a></li>
<li class="chapter" data-level="13.3" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html#loading-the-data"><i class="fa fa-check"></i><b>13.3</b> Loading the data</a></li>
<li class="chapter" data-level="13.4" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html#data-cleaningprocessing"><i class="fa fa-check"></i><b>13.4</b> Data cleaning/processing</a></li>
<li class="chapter" data-level="13.5" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html#data-monitoring"><i class="fa fa-check"></i><b>13.5</b> Data monitoring</a><ul>
<li class="chapter" data-level="13.5.1" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html#data-validation"><i class="fa fa-check"></i><b>13.5.1</b> Data validation</a></li>
<li class="chapter" data-level="13.5.2" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html#data-presentation-dsmc-style"><i class="fa fa-check"></i><b>13.5.2</b> Data presentation (DSMC-style)</a></li>
<li class="chapter" data-level="13.5.3" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html#appendix-if-necessary"><i class="fa fa-check"></i><b>13.5.3</b> Appendix (if necessary)</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html#summary"><i class="fa fa-check"></i><b>13.6</b> Summary</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Proctor Foundation Data Science Handbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="datawrangling" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Data Wrangling</h1>
<p><em>Contributors: Kunal Mishra, Jade Benjamin-Chung, Ben Arnold</em></p>
<div id="overview" class="section level2">
<h2><span class="header-section-number">6.1</span> Overview</h2>
<p>Processing data from raw inputs to final data for analysis is the foundation of the data science <a href="workflows.html#workflows">workflow</a>. “Management” is a bad word in both academia and hip parts of the private sector, so what used to be called “data management” is now called “data wrangling” or “data munging”.</p>
<p>By any name, it is by far the most tedious and time consuming step in the data analysis workflow. Data wrangling is also the most error prone. Errors are likely because data processing usually requires hundreds or thousands of lines of code. Generating final datasets often requires programmers to merge and append multiple different raw datasets; often, the process requires them to re-shape the data from wide format to long format.</p>
<p>Read the chapters on <a href="https://r4ds.had.co.nz/">Data Wrangling</a> in <em>R for Data Science</em>. That book covers the foundational skills and know-how.</p>
<p>Here, we provide some additional recommendations for best practices related to data wrangling and highlight a few topics not covered in the excellent R for Data Science book.</p>
</div>
<div id="cardinal-rule" class="section level2">
<h2><span class="header-section-number">6.2</span> Cardinal rule</h2>
<hr />
<blockquote>
<p><em><strong>Cardinal rule of data wrangling:</strong> NEVER alter untouched datasets</em></p>
</blockquote>
<hr />
<p>Untouched datasets include data output from data collection software, distributed by the data team, outside collaborators, or downloaded from a data repository. They should be left untouched. All data cleaning and processing activities should read in untouched data and output either temporary files or final datasets. Never, ever overwrite an untouched dataset.</p>
</div>
<div id="data-inputoutput-io" class="section level2">
<h2><span class="header-section-number">6.3</span> Data input/output (I/O)</h2>
<p>Read the <a href="https://r4ds.had.co.nz/data-import.html">Data Import</a> section of <em>R for Data Science</em>.</p>
<div id="excel-files" class="section level3">
<h3><span class="header-section-number">6.3.1</span> Excel files</h3>
<p>Often collaborators share data as Excel files (<code>.xlsx</code>). In this case, we recommend making a copy of the file in the untouched repository and converting it into a <code>.csv</code> file (one per tab) to input into the data processing workflow.</p>
<p>This step should mark the end of your use of Excel in your data analysis, aside from inspecting <code>.csv</code> files. Excel is extremely error prone because it does not have good fidelity with variable types (e.g., dates, leading zeros), and has no real programmatic interface (VBA?). Avoid it. We can find no compelling case for its use in data science.</p>
</div>
<div id="rds-vs-.rdata-files" class="section level3">
<h3><span class="header-section-number">6.3.2</span> <code>.RDS</code> vs <code>.RData</code> Files</h3>
<p>One of the most common ways to load and save data in Base R is with the <code>load()</code> and <code>save()</code> functions to serialize multiple objects in a single <code>.RData</code> file. The biggest problems with this practice include an inability to control the names of things getting loaded in, the inherent confusion this creates in understanding older code, and the inability to load individual elements of a saved file. For this, we recommend using the RDS format to save R objects using <code>saveRDS()</code> and its complement <code>readRDS()</code>.</p>
<ul>
<li><p><strong>Note</strong>: if you have many related R objects you would have otherwise saved all together using the <code>save</code> function, the functional equivalent with <code>RDS</code> would be to create a (named) list containing each of these objects, and saving it.</p></li>
<li><p><strong>Note</strong>: there is an important caveat for <code>.rds</code> files: they are not automatically backward compatible across different versions of R! So, while they are very useful in general, beware. See, for example, this thread on <a href="https://stackoverflow.com/questions/56704638/write-a-file-using-saverds-so-that-it-is-backwards-compatible-with-old-versi">StackExchange</a>. <code>.csv</code> files embed slightly less information (typically), but are more stable across different versions of R.</p></li>
</ul>
</div>
<div id="csv-files" class="section level3">
<h3><span class="header-section-number">6.3.3</span> <code>.CSV</code> Files</h3>
<p>Once again, the <code>readr</code> package as part of the Tidvyerse is great, with a much faster <code>read_csv()</code> than Base R’s <code>read.csv()</code>. For massive CSVs (&gt; 5 GB), you’ll find <code>data.table::fread()</code> to be the fastest CSV reader in any data science language out there. For writing CSVs, <code>readr::write_csv()</code> and <code>data.table::fwrite()</code> outclass Base R’s <code>write.csv()</code> by a significant margin as well.</p>
</div>
<div id="publishing-public-data" class="section level3">
<h3><span class="header-section-number">6.3.4</span> Publishing public data</h3>
<p><strong>NEVER</strong> push a dataset into the public domain (e.g., GitHub, OSF) without first checking with Ben to ensure that it is appropriately de-identified and we have approval from the sponsor and/or human subjects review board to do so. For example, we will need to re-code participant IDs (even if they contain no identifying information) before making data public to completely break the link between IDs and identifiable information stored on our servers.</p>
<p>If you are releasing data into the public domain, then consider making available <em>at minimum</em> a <code>.csv</code> file and a codebook of the same name (note: you should have a codebook for internal data as well). We often also make available <code>.rds</code> files as well. For example, your <code>mystudy/data/public</code> directory could include three files for a single dataset, two with the actual data in <code>.rds</code> and <code>.csv</code> formats, and a third that describes their contents:</p>
<pre><code>analysis_data_public.csv
analysis_data_public.rds
analysis_data_public_codebook.txt</code></pre>
<p>In general, datasets are usually too big to save on GitHub, but occasionally they are small. Here is an example of where we actually pushed the data directly to GitHub: <a href="https://github.com/ben-arnold/enterics-seroepi/tree/master/data" class="uri">https://github.com/ben-arnold/enterics-seroepi/tree/master/data</a> .</p>
<p>If the data are bigger, then maintaining them under version control in your git repository can be unweildy. Instead, we recommend using another stable repository that has version control, such as the Open Science Framework (<a href="https://osf.io">osf.io</a>). For example, all of the data from the WASH Benefits trials (led by investigators at Berkeley, icddr,b, IPA-Kenya and others) are all stored through data components nested within in OSF projects: <a href="https://osf.io/tprw2/" class="uri">https://osf.io/tprw2/</a>. Another good option is Dryad (<a href="https://datadryad.org/">datadryad.org</a>), which normally costs a nominal fee to archive data but is free to investigators in the University of California system.</p>
<p>As of this time, we recommend cross-linking public files in GitHub (scripts/notebooks only), OSF, and Dryad.</p>
</div>
</div>
<div id="documenting-datasets" class="section level2">
<h2><span class="header-section-number">6.4</span> Documenting datasets</h2>
<p>Datasets need to have metadata (documentation) associated with them to help people understand them. Well documented datasets save an enormous amount of time because it helps avoid lots of back-and-forth with new people orienting themselves with the data. This applies to both private and public data used in your work flow.</p>
<p>Each raw and final dataset should include a codebook. Sometimes survey instruments or electronic data capture schematics can stand-in for raw dataset codebooks, as long as that information is stored alongside the raw data!</p>
<p>The file <a href="https://github.com/ben-arnold/enterics-seroepi/blob/master/data/asembo_analysis_codebook.txt">asembo_analysis_codebook.txt</a> provides one example of what a codebook for a simple, final dataset could contain.</p>
<p>For complex studies with multiple, relational data files, it is exceptionally helpful to also include a README overview in plain text or markdown that explains the relationships between the datasets. Here is an example from the WASH Benefits Bangladesh trial primary outcomes analysis: <a href="https://osf.io/v3nfs/">README-WBB-primary-outcomes-datasets.md</a>.</p>
</div>
<div id="mapping-data-from-untouched---final" class="section level2">
<h2><span class="header-section-number">6.5</span> Mapping data from untouched -&gt; final</h2>
<p>An important step for the data processing is to come up with a plan for which final datasets you want to create.</p>
<p>Best pracice is to scope out the flow of data from the original forms/modules/tables at the time of data capture to the final datasets planned for the analysis, and ensure that there is a <code>Key</code> linking each table needed to create the final analysis datasets.</p>
<p>These are probably the two most common models for the end product:</p>
<table>
<colgroup>
<col width="19%" />
<col width="80%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">Single Massive Dataset</td>
<td align="left">A single, large, final dataset for the whole project with potentially multiple levels of data (e.g., household, individual) and hundreds or thousands of variables.</td>
</tr>
<tr class="even">
<td align="left">Multiple Relational datasets</td>
<td align="left">Multiple relational datasets, each tailored to a specific type of data collected in the study. Smaller, relational datasets can be recombined as needed for analyses.</td>
</tr>
</tbody>
</table>
<p>We strongly recommend using the second model, relational data tables, in almost every case. The chapter on <a href="https://r4ds.had.co.nz/relational-data.html">Relational Data</a> in R for Data Science explains details.</p>
<blockquote>
<p>Rationale: If you create a single massive dataset that includes information at multiple levels, then it can create challenges. First, the datasets are unwieldy, often consisting of hundreds or thousands of variables; this makes it difficult to find variables, difficult to view the data through a software browser, and easy to forget about variables. <em>But there are bigger problems</em>. Datasets with an exceptionally large number of variables or multiple levels of data in the same file make it difficult to visually detect pathological problems in the data (e.g., unexpected missing values). For studies that include data from multiple levels (e.g., communities, households, individuals) the inclusion of multiple types of data in the same file makes analyses error prone because it requires the programmer to keep track of when variables include duplicated observations. For example, the inclusion of household characteristics in an individual-level data file means that if there are multiple individuals per household, that simple means of household characteristics cannot be calculated without first restricting the file to unique observations at the household level.</p>
</blockquote>
</div>
<div id="relational-data" class="section level2">
<h2><span class="header-section-number">6.6</span> Relational data</h2>
<p>Refer to <a href="https://r4ds.had.co.nz/relational-data.html">Relational Data</a> in <em>R for Data Science</em> for a good example of what a good relational database can look like.</p>
<p><strong>Important</strong>: For a set of relational tables to work, you must ensure that each table relates to another with a unique <code>Key</code>. For example, a child-level dataset must also include IDs for household- or cluster to be merged to household or cluster level data.</p>
<p>Practical advice on <code>Key</code> variables / IDs used to link datasets. Numeric IDs can occasionally cause problems with merges due to machine rounding errors so character values can sometimes be a good alternative. Whatever format you use, ensure that they do not in some way encode identifying information (e.g., using a social security number or medical record number would be a poor choice of ID for a final dataset).</p>
</div>
<div id="be-careful-with-joins-merges" class="section level2">
<h2><span class="header-section-number">6.7</span> Be careful with joins / merges</h2>
<p>Experience shows that merging datasets is one of the most error prone steps in data wrangling. Merges can be particularly tricky for less experienced programmers. Errors are likely early in the data processing work flow, and less likely when merging final datasets with clean key variables (IDs) and clear relationships between datasets. Carefully check each merge to ensure it is working as you expect.</p>
<blockquote>
<p><strong>ESSENTIAL READING:</strong> <a href="https://r4ds.had.co.nz/relational-data.html#join-problems">Join Problems</a> in <em>R for Data Science</em></p>
</blockquote>
<p>In the Stata software there is a really nice feature with <code>merge</code> that allows you to specify the type of merge/join and then examine the diagnostics of that merge.</p>
<p>Although R does not have a similarly nice feature at this time, the different <code>join</code> functions in the <code>dplyr</code> package provide all of the tools you need to correctly join your data.</p>
<p>In our experience, the two most common types of joins in our work are mutating joins and filtering joints. (from the <em>R for Data Science</em> book):</p>
<blockquote>
<p><strong>Mutating joins</strong>: add new variables to one data frame from matching observations in another.</p>
</blockquote>
<blockquote>
<p><strong>Filtering joins</strong>: filter observations from one data frame based on whether or not they match an observation in the other table.</p>
</blockquote>
<p>Familiarize yourself with these types of operations. The <a href="https://r4ds.had.co.nz/relational-data.html">Relational data</a> chapter of <em>R for Data Science</em> includes details.</p>
</div>
<div id="reshaping-data" class="section level2">
<h2><span class="header-section-number">6.8</span> Reshaping data</h2>
<p>The <code>dplyr</code> package introduced the <code>pivot_wider</code> and <code>pivot_longer</code> functions in 2019. They make reshaping data dramatically easier than any previous functions, including <code>reshape()</code> (base R) or <code>gather</code>/<code>spread</code> (Tidyverse). This excellent article includes details:</p>
<p><a href="https://tidyr.tidyverse.org/dev/articles/pivot.html" class="uri">https://tidyr.tidyverse.org/dev/articles/pivot.html</a></p>
</div>
<div id="data-cleaning" class="section level2">
<h2><span class="header-section-number">6.9</span> Data cleaning</h2>
<p>Data cleaning is typically an iterative process that you should conduct on a variable-by-variable basis. Occasionally it is useful to clean an entire questionnaire module at the same time since variables in the same module can be related to one another, and since it can help to proceed through the cleaning process in well-defined chunks. I find it helpful to have a copy of the survey questionnaire (if relevant) handy while cleaning specific variables. This enables you to check skip patterns and codes in the survey against the dataset.</p>
<p>We don’t have a lot of general advice for data cleaning except the following. First, there is something to be said for “trolling” (in the fishing sense) or visually scrolling through parts of the dataset to see what the data look like and to make sure you have a feel for how information is stored in different variables (e.g., are missing values coded or simply recored as “<code>.</code>” or <code>NA</code>). Use the <code>View()</code> utility in <code>RStudio</code> to look at your data often during the cleaning process. Second, it can be helpful to consolidate all data cleaning into a single program for each dataset. The data cleaning program corrects entry errors, labels variables, formats variables, and outputs either a temporary or final dataset (but does not, ever, overwrite the untouched data). As noted in the <a href="workflows.html#workflows">Workflows</a> chapter, <em>key data processing should be done once, at the earliest possible place in the workflow</em>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="codingstyle.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bigdata.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["dcc-handbook.pdf", "dcc-handbook.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
