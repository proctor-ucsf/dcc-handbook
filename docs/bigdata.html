<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Working with Big Data | Proctor Foundation Data Science Handbook</title>
  <meta name="description" content="This is a handbook to help summarize best practices in data science among team members at the Francis I. Proctor Foundation." />
  <meta name="generator" content="bookdown 0.13 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Working with Big Data | Proctor Foundation Data Science Handbook" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a handbook to help summarize best practices in data science among team members at the Francis I. Proctor Foundation." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Working with Big Data | Proctor Foundation Data Science Handbook" />
  
  <meta name="twitter:description" content="This is a handbook to help summarize best practices in data science among team members at the Francis I. Proctor Foundation." />
  

<meta name="author" content="Contributors: Ben Arnold, Jade Benjamin-Chung, Kunal Mishra, Anna Nguyen, Nolan Pokpongkiat, Stephanie Djajadi, Eric Kim, Will Godwin (many from UC Berkeley in addition to Proctor)" />


<meta name="date" content="2020-01-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="datawrangling.html"/>
<link rel="next" href="github.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Proctor Data Science Handbook</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome!</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction: Work Flow and Reproducible Analyses</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#workflow"><i class="fa fa-check"></i><b>1.1</b> Workflow</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#reproducibility"><i class="fa fa-check"></i><b>1.2</b> Reproducibility</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#automation"><i class="fa fa-check"></i><b>1.3</b> Automation</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="workflows.html"><a href="workflows.html"><i class="fa fa-check"></i><b>2</b> Workflows</a></li>
<li class="chapter" data-level="3" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html"><i class="fa fa-check"></i><b>3</b> Directory Structure and Code Repositories</a><ul>
<li class="chapter" data-level="3.1" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#small-and-large-projects"><i class="fa fa-check"></i><b>3.1</b> Small and large projects</a></li>
<li class="chapter" data-level="3.2" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#directory-structure"><i class="fa fa-check"></i><b>3.2</b> Directory Structure</a><ul>
<li class="chapter" data-level="3.2.1" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#first-level-data-and-analyses"><i class="fa fa-check"></i><b>3.2.1</b> First level: data and analyses</a></li>
<li class="chapter" data-level="3.2.2" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#second-level-data"><i class="fa fa-check"></i><b>3.2.2</b> Second level: data</a></li>
<li class="chapter" data-level="3.2.3" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#second-level-analysis"><i class="fa fa-check"></i><b>3.2.3</b> Second level: analysis</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#code-repositories"><i class="fa fa-check"></i><b>3.3</b> Code Repositories</a><ul>
<li class="chapter" data-level="3.3.1" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#rproj-files"><i class="fa fa-check"></i><b>3.3.1</b> <code>.Rproj</code> files</a></li>
<li class="chapter" data-level="3.3.2" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#configuration-config-file"><i class="fa fa-check"></i><b>3.3.2</b> Configuration (‘config’) File</a></li>
<li class="chapter" data-level="3.3.3" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#shared-functions-file"><i class="fa fa-check"></i><b>3.3.3</b> Shared Functions File</a></li>
<li class="chapter" data-level="3.3.4" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#order-files-and-subdirectories"><i class="fa fa-check"></i><b>3.3.4</b> Order Files and Subdirectories</a></li>
<li class="chapter" data-level="3.3.5" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#use-bash-scripts-to-ensure-reproducibility"><i class="fa fa-check"></i><b>3.3.5</b> Use Bash scripts to ensure reproducibility</a></li>
<li class="chapter" data-level="3.3.6" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#alternative-approach-for-code-repos"><i class="fa fa-check"></i><b>3.3.6</b> Alternative approach for code repos</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="codingpractices.html"><a href="codingpractices.html"><i class="fa fa-check"></i><b>4</b> Coding Practices</a><ul>
<li class="chapter" data-level="4.1" data-path="codingpractices.html"><a href="codingpractices.html#organizing-scripts"><i class="fa fa-check"></i><b>4.1</b> Organizing scripts</a></li>
<li class="chapter" data-level="4.2" data-path="codingpractices.html"><a href="codingpractices.html#documenting-your-code"><i class="fa fa-check"></i><b>4.2</b> Documenting your code</a><ul>
<li class="chapter" data-level="4.2.1" data-path="codingpractices.html"><a href="codingpractices.html#file-headers"><i class="fa fa-check"></i><b>4.2.1</b> File headers</a></li>
<li class="chapter" data-level="4.2.2" data-path="codingpractices.html"><a href="codingpractices.html#comments-in-the-body-of-your-script"><i class="fa fa-check"></i><b>4.2.2</b> Comments in the body of your script</a></li>
<li class="chapter" data-level="4.2.3" data-path="codingpractices.html"><a href="codingpractices.html#function-documentation"><i class="fa fa-check"></i><b>4.2.3</b> Function documentation</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="codingpractices.html"><a href="codingpractices.html#object-naming"><i class="fa fa-check"></i><b>4.3</b> Object naming</a></li>
<li class="chapter" data-level="4.4" data-path="codingpractices.html"><a href="codingpractices.html#function-calls"><i class="fa fa-check"></i><b>4.4</b> Function calls</a></li>
<li class="chapter" data-level="4.5" data-path="codingpractices.html"><a href="codingpractices.html#the-here-package"><i class="fa fa-check"></i><b>4.5</b> The <code>here</code> package</a></li>
<li class="chapter" data-level="4.6" data-path="codingpractices.html"><a href="codingpractices.html#tidyverse"><i class="fa fa-check"></i><b>4.6</b> Tidyverse</a></li>
<li class="chapter" data-level="4.7" data-path="codingpractices.html"><a href="codingpractices.html#coding-with-r-and-python"><i class="fa fa-check"></i><b>4.7</b> Coding with R and Python</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="codingstyle.html"><a href="codingstyle.html"><i class="fa fa-check"></i><b>5</b> Coding Style</a><ul>
<li class="chapter" data-level="5.1" data-path="codingstyle.html"><a href="codingstyle.html#line-breaks"><i class="fa fa-check"></i><b>5.1</b> Line breaks</a></li>
<li class="chapter" data-level="5.2" data-path="codingstyle.html"><a href="codingstyle.html#automated-tools-for-style-and-project-workflow"><i class="fa fa-check"></i><b>5.2</b> Automated Tools for Style and Project Workflow</a><ul>
<li class="chapter" data-level="5.2.1" data-path="codingstyle.html"><a href="codingstyle.html#styling"><i class="fa fa-check"></i><b>5.2.1</b> Styling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="datawrangling.html"><a href="datawrangling.html"><i class="fa fa-check"></i><b>6</b> Data Wrangling</a><ul>
<li class="chapter" data-level="6.1" data-path="datawrangling.html"><a href="datawrangling.html#overview"><i class="fa fa-check"></i><b>6.1</b> Overview</a></li>
<li class="chapter" data-level="6.2" data-path="datawrangling.html"><a href="datawrangling.html#cardinal-rule"><i class="fa fa-check"></i><b>6.2</b> Cardinal rule</a></li>
<li class="chapter" data-level="6.3" data-path="datawrangling.html"><a href="datawrangling.html#data-inputoutput-io"><i class="fa fa-check"></i><b>6.3</b> Data input/output (I/O)</a><ul>
<li class="chapter" data-level="6.3.1" data-path="datawrangling.html"><a href="datawrangling.html#excel-files"><i class="fa fa-check"></i><b>6.3.1</b> Excel files</a></li>
<li class="chapter" data-level="6.3.2" data-path="datawrangling.html"><a href="datawrangling.html#rds-vs-.rdata-files"><i class="fa fa-check"></i><b>6.3.2</b> <code>.RDS</code> vs <code>.RData</code> Files</a></li>
<li class="chapter" data-level="6.3.3" data-path="datawrangling.html"><a href="datawrangling.html#csv-files"><i class="fa fa-check"></i><b>6.3.3</b> <code>.CSV</code> Files</a></li>
<li class="chapter" data-level="6.3.4" data-path="datawrangling.html"><a href="datawrangling.html#publishing-public-data"><i class="fa fa-check"></i><b>6.3.4</b> Publishing public data</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="datawrangling.html"><a href="datawrangling.html#documenting-datasets"><i class="fa fa-check"></i><b>6.4</b> Documenting datasets</a></li>
<li class="chapter" data-level="6.5" data-path="datawrangling.html"><a href="datawrangling.html#mapping-data-from-untouched---final"><i class="fa fa-check"></i><b>6.5</b> Mapping data from untouched -&gt; final</a></li>
<li class="chapter" data-level="6.6" data-path="datawrangling.html"><a href="datawrangling.html#relational-data"><i class="fa fa-check"></i><b>6.6</b> Relational data</a></li>
<li class="chapter" data-level="6.7" data-path="datawrangling.html"><a href="datawrangling.html#be-careful-with-joins-merges"><i class="fa fa-check"></i><b>6.7</b> Be careful with joins / merges</a></li>
<li class="chapter" data-level="6.8" data-path="datawrangling.html"><a href="datawrangling.html#reshaping-data"><i class="fa fa-check"></i><b>6.8</b> Reshaping data</a></li>
<li class="chapter" data-level="6.9" data-path="datawrangling.html"><a href="datawrangling.html#data-cleaning"><i class="fa fa-check"></i><b>6.9</b> Data cleaning</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="bigdata.html"><a href="bigdata.html"><i class="fa fa-check"></i><b>7</b> Working with Big Data</a><ul>
<li class="chapter" data-level="7.1" data-path="bigdata.html"><a href="bigdata.html#basics"><i class="fa fa-check"></i><b>7.1</b> Basics</a></li>
<li class="chapter" data-level="7.2" data-path="bigdata.html"><a href="bigdata.html#using-downsampled-data"><i class="fa fa-check"></i><b>7.2</b> Using downsampled data</a></li>
<li class="chapter" data-level="7.3" data-path="bigdata.html"><a href="bigdata.html#big-data-unix"><i class="fa fa-check"></i><b>7.3</b> Unix</a></li>
<li class="chapter" data-level="7.4" data-path="bigdata.html"><a href="bigdata.html#sql-and-dbplyr"><i class="fa fa-check"></i><b>7.4</b> SQL and <code>dbplyr</code></a></li>
<li class="chapter" data-level="7.5" data-path="bigdata.html"><a href="bigdata.html#data.table-and-dtplyr"><i class="fa fa-check"></i><b>7.5</b> <code>data.table</code> and <code>dtplyr</code></a></li>
<li class="chapter" data-level="7.6" data-path="bigdata.html"><a href="bigdata.html#ff-bigmemory-biglm"><i class="fa fa-check"></i><b>7.6</b> <code>ff</code>, <code>bigmemory</code>, <code>biglm</code></a></li>
<li class="chapter" data-level="7.7" data-path="bigdata.html"><a href="bigdata.html#parallel-computing"><i class="fa fa-check"></i><b>7.7</b> Parallel computing</a><ul>
<li class="chapter" data-level="7.7.1" data-path="bigdata.html"><a href="bigdata.html#embarrassingly-parallel-problems"><i class="fa fa-check"></i><b>7.7.1</b> Embarrassingly Parallel Problems</a></li>
<li class="chapter" data-level="7.7.2" data-path="bigdata.html"><a href="bigdata.html#packages"><i class="fa fa-check"></i><b>7.7.2</b> Packages</a></li>
<li class="chapter" data-level="7.7.3" data-path="bigdata.html"><a href="bigdata.html#gpus"><i class="fa fa-check"></i><b>7.7.3</b> GPU’s</a></li>
<li class="chapter" data-level="7.7.4" data-path="bigdata.html"><a href="bigdata.html#the-mapreduce-paradigm"><i class="fa fa-check"></i><b>7.7.4</b> The <em>MapReduce</em> paradigm</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="bigdata.html"><a href="bigdata.html#optimal-rstudio-set-up"><i class="fa fa-check"></i><b>7.8</b> Optimal RStudio set up</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="github.html"><a href="github.html"><i class="fa fa-check"></i><b>8</b> GitHub and Version Control</a><ul>
<li class="chapter" data-level="8.1" data-path="github.html"><a href="github.html#basics-1"><i class="fa fa-check"></i><b>8.1</b> Basics</a></li>
<li class="chapter" data-level="8.2" data-path="github.html"><a href="github.html#git-branching"><i class="fa fa-check"></i><b>8.2</b> Git Branching</a></li>
<li class="chapter" data-level="8.3" data-path="github.html"><a href="github.html#example-workflow"><i class="fa fa-check"></i><b>8.3</b> Example Workflow</a></li>
<li class="chapter" data-level="8.4" data-path="github.html"><a href="github.html#commonly-used-git-commands"><i class="fa fa-check"></i><b>8.4</b> Commonly Used Git Commands</a></li>
<li class="chapter" data-level="8.5" data-path="github.html"><a href="github.html#how-often-should-i-commit"><i class="fa fa-check"></i><b>8.5</b> How often should I commit?</a></li>
<li class="chapter" data-level="8.6" data-path="github.html"><a href="github.html#what-should-be-pushed-to-github"><i class="fa fa-check"></i><b>8.6</b> What should be pushed to Github?</a></li>
<li class="chapter" data-level="8.7" data-path="github.html"><a href="github.html#how-should-i-describe-my-commit"><i class="fa fa-check"></i><b>8.7</b> How should I describe my commit?</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="unix.html"><a href="unix.html"><i class="fa fa-check"></i><b>9</b> UNIX Commands</a><ul>
<li class="chapter" data-level="9.1" data-path="unix.html"><a href="unix.html#environment"><i class="fa fa-check"></i><b>9.1</b> Environment</a></li>
<li class="chapter" data-level="9.2" data-path="unix.html"><a href="unix.html#basics-2"><i class="fa fa-check"></i><b>9.2</b> Basics</a></li>
<li class="chapter" data-level="9.3" data-path="unix.html"><a href="unix.html#syntax-for-both-macwindows"><i class="fa fa-check"></i><b>9.3</b> Syntax for both Mac/Windows</a></li>
<li class="chapter" data-level="9.4" data-path="unix.html"><a href="unix.html#running-bash-scripts"><i class="fa fa-check"></i><b>9.4</b> Running Bash Scripts</a></li>
<li class="chapter" data-level="9.5" data-path="unix.html"><a href="unix.html#running-rscripts-in-windows"><i class="fa fa-check"></i><b>9.5</b> Running Rscripts in Windows</a><ul>
<li class="chapter" data-level="9.5.1" data-path="unix.html"><a href="unix.html#common-mistakes"><i class="fa fa-check"></i><b>9.5.1</b> Common Mistakes</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="unix.html"><a href="unix.html#checking-tasks-and-killing-jobs"><i class="fa fa-check"></i><b>9.6</b> Checking tasks and killing jobs</a></li>
<li class="chapter" data-level="9.7" data-path="unix.html"><a href="unix.html#running-big-jobs"><i class="fa fa-check"></i><b>9.7</b> Running big jobs</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html"><i class="fa fa-check"></i><b>10</b> Building Automated Markdown Reports</a><ul>
<li class="chapter" data-level="10.1" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html#setting-up-the-markdown"><i class="fa fa-check"></i><b>10.1</b> Setting up the markdown</a><ul>
<li class="chapter" data-level="10.1.1" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html#yaml"><i class="fa fa-check"></i><b>10.1.1</b> YAML</a></li>
<li class="chapter" data-level="10.1.2" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html#directory-structure-1"><i class="fa fa-check"></i><b>10.1.2</b> Directory structure</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html#automating-the-data-export-process"><i class="fa fa-check"></i><b>10.2</b> Automating the data export process</a></li>
<li class="chapter" data-level="10.3" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html#loading-the-data"><i class="fa fa-check"></i><b>10.3</b> Loading the data</a></li>
<li class="chapter" data-level="10.4" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html#data-cleaningprocessing"><i class="fa fa-check"></i><b>10.4</b> Data cleaning/processing</a></li>
<li class="chapter" data-level="10.5" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html#data-monitoring"><i class="fa fa-check"></i><b>10.5</b> Data monitoring</a><ul>
<li class="chapter" data-level="10.5.1" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html#data-validation"><i class="fa fa-check"></i><b>10.5.1</b> Data validation</a></li>
<li class="chapter" data-level="10.5.2" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html#data-presentation-dsmc-style"><i class="fa fa-check"></i><b>10.5.2</b> Data presentation (DSMC-style)</a></li>
<li class="chapter" data-level="10.5.3" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html#appendix-if-necessary"><i class="fa fa-check"></i><b>10.5.3</b> Appendix (if necessary)</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="building-automated-markdown-reports.html"><a href="building-automated-markdown-reports.html#summary"><i class="fa fa-check"></i><b>10.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="commcoord.html"><a href="commcoord.html"><i class="fa fa-check"></i><b>11</b> Communication and Coordination</a><ul>
<li class="chapter" data-level="11.1" data-path="commcoord.html"><a href="commcoord.html#slack"><i class="fa fa-check"></i><b>11.1</b> Slack</a></li>
<li class="chapter" data-level="11.2" data-path="commcoord.html"><a href="commcoord.html#email"><i class="fa fa-check"></i><b>11.2</b> Email</a></li>
<li class="chapter" data-level="11.3" data-path="commcoord.html"><a href="commcoord.html#trello"><i class="fa fa-check"></i><b>11.3</b> Trello</a></li>
<li class="chapter" data-level="11.4" data-path="commcoord.html"><a href="commcoord.html#google-drive"><i class="fa fa-check"></i><b>11.4</b> Google Drive</a></li>
<li class="chapter" data-level="11.5" data-path="commcoord.html"><a href="commcoord.html#calendar-meetings"><i class="fa fa-check"></i><b>11.5</b> Calendar / Meetings</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="code-of-conduct.html"><a href="code-of-conduct.html"><i class="fa fa-check"></i><b>12</b> Code of conduct</a><ul>
<li class="chapter" data-level="12.1" data-path="code-of-conduct.html"><a href="code-of-conduct.html#group-culture"><i class="fa fa-check"></i><b>12.1</b> Group culture</a></li>
<li class="chapter" data-level="12.2" data-path="code-of-conduct.html"><a href="code-of-conduct.html#protecting-human-subjects"><i class="fa fa-check"></i><b>12.2</b> Protecting human subjects</a></li>
<li class="chapter" data-level="12.3" data-path="code-of-conduct.html"><a href="code-of-conduct.html#authorship"><i class="fa fa-check"></i><b>12.3</b> Authorship</a></li>
<li class="chapter" data-level="12.4" data-path="code-of-conduct.html"><a href="code-of-conduct.html#work-hours"><i class="fa fa-check"></i><b>12.4</b> Work hours</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>13</b> Additional Resources</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Proctor Foundation Data Science Handbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bigdata" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Working with Big Data</h1>
<p><em>Contributors: Eric Kim, Kunal Mishra and Jade Benjamin-Chung</em></p>
<div id="basics" class="section level2">
<h2><span class="header-section-number">7.1</span> Basics</h2>
<p>A pitfall of working in R is that all objects are stored in memory - this makes it very difficult to work with datasets that are larger than 1-2 Gb for most standard computers. Here, we’ll explore some alternatives to working with big data.</p>
<p>The Berkeley Statistical Computing Facility also has many good <a href="http://statistics.berkeley.edu/computing/training">training resources</a>.</p>
</div>
<div id="using-downsampled-data" class="section level2">
<h2><span class="header-section-number">7.2</span> Using downsampled data</h2>
<p>In studies with very large datasets, we save “downsampled” data that usually includes a 1% random sample stratified by any important variables, such as year or household id. This allows us to efficiently write and test our code without having to load in large, slow datasets that can cause RStudio to freeze. Be very careful to be sure which dataset you are working with and to label results output accordingly.</p>
</div>
<div id="big-data-unix" class="section level2">
<h2><span class="header-section-number">7.3</span> Unix</h2>
<p>Though bash is very commonly used for management of your file system (see Chapter <a href="unix.html#unix">9</a>), it is also a very capable at doing basic data manipulation with big data. At the core, since the data is stored on disk, you avoid having to overload memory when using bash commands as it will work with the files directly. By default, these commands will print the results to standard output (probably your terminal screen), but you can then redirect the results to other files on disk to save your results. These commands can also be chained via pipes (represented as <code>|</code>, similar to <code>%&gt;%</code> in tidyverse). All of these have a list of arguments that can be passed in via flags (check the <code>man</code> page for more details on each).</p>
<table>
<colgroup>
<col width="43%" />
<col width="56%" />
</colgroup>
<thead>
<tr class="header">
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>head</code>/<code>tail</code></td>
<td>Displays the first few or last few rows of a file</td>
</tr>
<tr class="even">
<td><code>cat</code></td>
<td>Concatenates files and prints them</td>
</tr>
<tr class="odd">
<td><code>sort</code></td>
<td>Sorts the file</td>
</tr>
<tr class="even">
<td><code>cut</code></td>
<td>Cuts out portions of each line and prints it</td>
</tr>
<tr class="odd">
<td><code>grep</code></td>
<td>Finds lines of a file that matches inputted patterns</td>
</tr>
<tr class="even">
<td><code>sed</code></td>
<td>Find and replace</td>
</tr>
<tr class="odd">
<td><code>awk</code></td>
<td>Similar to <code>grep</code> and <code>sed</code> but with some extra programmatic functionality</td>
</tr>
<tr class="even">
<td><code>uniq</code></td>
<td>Unifies repeated lines (combine with <code>sort</code> to get unique rows)</td>
</tr>
<tr class="odd">
<td><code>wget</code> / <code>curl</code></td>
<td>Downloads data/files from websites</td>
</tr>
</tbody>
</table>
</div>
<div id="sql-and-dbplyr" class="section level2">
<h2><span class="header-section-number">7.4</span> SQL and <code>dbplyr</code></h2>
<p>SQL databases are relational databases that are a collection of <em>tables</em> that consists of <em>fields</em> or <em>attributes</em>, each containing a single <em>type</em>. If you use <code>dplyr</code> a lot, you will find that it is heavily inspired with a SQL flavor in mind. Formally, data gets loaded onto a database system and it is stored on disk. This alone makes working with data fast, but the real efficiency gain is in the concept of indexing. If you are curious, most SQL databases implement their index with B trees or B+ trees, which allow for log time complexity for search operations in average and worst case scenarios while providing constant time complexity in best case scenario.</p>
<p>The basic structure of a SQL query is as follows:</p>
<pre><code>SELECT [DISTINCT] (attributes)
FROM (table)
[WHERE (conditions)]
[GROUP BY (attributes) [HAVING (conditions)]]
[ORDER BY (attributes) [DESC]]</code></pre>
<p>The equivalent <code>dplyr</code> command would look as such:</p>
<pre><code>table %&gt;%
  select(attributes) %&gt;%     # distinct(attributes) for select distinct
  group_by(attributes) %&gt;%   # 
  filter(conditions) %&gt;%     # 
  arrange(attributes)        # arrange(desc(attributes)) for descending</code></pre>
<p>There is ample support for connection to databases in R, and, in particular, there is the <a href="https://dbplyr.tidyverse.org"><code>dbplyr</code></a> package, which allows you to interface with the data with <code>dplyr</code> code instead of SQL code.</p>
</div>
<div id="data.table-and-dtplyr" class="section level2">
<h2><span class="header-section-number">7.5</span> <code>data.table</code> and <code>dtplyr</code></h2>
<p>It is often possible to load large datasets into memory in R, but computations will require more consumption of memory and will probably be very slow. One way around this is to use <code>data.table</code>. You will find that operations on the data are much faster than base R or <code>dplyr</code> even though data is loaded into memory - this is because of clever programming in C as well as internally creating a <em>key</em> (the SQL equivalent of an index) by default when loading in the data. You can improve on this even more by setting extra keys for variables you know you will be doing filter or join operations on.</p>
<p>More recently from the tidyverse, is the implementation of <a href="https://dtplyr.tidyverse.org"><code>dtplyr</code></a>, which allows for <code>dplyr</code> syntax on <code>data.table</code> objects.</p>
<p>An overview of the <code>dplyr</code> vs <code>data.table</code> debate can be found in <a href="https://stackoverflow.com/questions/21435339/data-table-vs-dplyr-can-one-do-something-well-the-other-cant-or-does-poorly/27840349#27840349">this stackoverflow post</a> and all 3 answers are worth a read.</p>
</div>
<div id="ff-bigmemory-biglm" class="section level2">
<h2><span class="header-section-number">7.6</span> <code>ff</code>, <code>bigmemory</code>, <code>biglm</code></h2>
<p>Sometimes, it may be impossible to load data into memory. Because of the overhead required, you can expect at least twice as much memory needed as the size of the file on disk to just load in a sufficiently large dataset and with all the other things that your computer needs to put on RAM in order to just run, you’ll run out of space. One way to work around this is to keep the data on disk and instead create clever data structures that allow for natural interfacing with the data by mapping operations to the data on disk. Two R packages that implement these ideas are <code>ff</code> and <code>bigmemory</code>.</p>
<p>We can interface with the data while avoiding loading it into memory with these packages, but we run into issues when we try to fit models on it. For an <span class="math inline">\(n \times p\)</span> dataset, linear regression has a time complexity of <span class="math inline">\(O(np^2 + p^3)\)</span> and a space complexity of <span class="math inline">\(O(np + p^2)\)</span> (this just means it will take a while and take up a lot of space for large <span class="math inline">\(n\)</span> and even moreso for large <span class="math inline">\(p\)</span>). So even if we <em>could</em> load the data on disk, fitting these models would be out of question. This is where standard solutions used in machine learning (iterative algorithms like stochastic gradient descent) can help us. The idea is to take a smaller portion of our data (which will fit in memory), fit the regression (which will take a reasonable amount of time), then update the coefficient based on another run of linear regression on another small portion of the data until convergence. For GLM models, this can be done with the <code>biglm</code> package which has integration with <code>ff</code> and <code>bigmemory</code>.</p>
</div>
<div id="parallel-computing" class="section level2">
<h2><span class="header-section-number">7.7</span> Parallel computing</h2>
<div id="embarrassingly-parallel-problems" class="section level3">
<h3><span class="header-section-number">7.7.1</span> Embarrassingly Parallel Problems</h3>
<p>Sometimes, we have to do something in a loop-like structure where each iteration may be independent of each other, such as simulations or bootstrap. These types of loops are referred to as <a href="https://en.wikipedia.org/wiki/Embarrassingly_parallel"><em>embarrassingly parallel</em></a> problems. Each iteration takes some time and every iteration thereafter must wait because the loop is operating as a queue, which gives a very obvious way to parallelize (hence “embarrassingly”). Every computer these days come with at least 2 cores in the CPU and each CPU core can operate independently, so after some overhead, we can speed up our loop by about a factor of the number of cores our computers have.</p>
</div>
<div id="packages" class="section level3">
<h3><span class="header-section-number">7.7.2</span> Packages</h3>
<p>In R, the popular packages to do this are <code>parallel</code>, <code>foreach</code>, and <code>doParallel</code> (the backend that connects <code>foreach</code> and <code>parallel</code>). More modern parallel computing packages in R are <code>future</code> and <code>furrr</code> (inspired by <code>future purrr</code>, it allows for <code>purrr</code> like syntax using the <code>future</code> data structure from its namesake package). In Python, the <code>Dask</code> library has similar functionality to R’s <code>future</code>. Note: the <code>parallel</code> package comes with a <code>detectCores</code> function, but I sometimes find that it is not accurate. On a Mac, you can manually check the number of cores by going into About This Mac then System Report then checking the Total Number of Cores in the Hardware tab.</p>
</div>
<div id="gpus" class="section level3">
<h3><span class="header-section-number">7.7.3</span> GPU’s</h3>
<p>For most everyday tasks, CPU will be sufficient, but for large problems even an 8x speed boost from a computer with 8 cores might not be enough. This is where GPU’s come into play. While CPU cores are good at complex operations, GPU cores are good at many small operations like matrix multiplication. GPU cores come in the hundreds for cheaper graphics cards and thousands for top end graphics cards, so they are ideal for training machine learning models, particularly neural networks. However, as these GPU cores were intended for the rendering of graphics on our computers, we cannot easily access their computing power out of R or Python without some translation in between. Graphics manufacturers have been catching up to this market, with one of the most popular platforms for parallel computing on GPU’s being Nvidia’s <a href="https://developer.nvidia.com/cuda-zone">CUDA</a> for use with Nvidia graphics cards.</p>
</div>
<div id="the-mapreduce-paradigm" class="section level3">
<h3><span class="header-section-number">7.7.4</span> The <em>MapReduce</em> paradigm</h3>
<p>The idea of the <em>MapReduce</em> paradigm is that we can distribute the data across many nodes and try to do the computation on each piece of the data in each node. One benefit of this is that if our data is too large to fit on disk for a single machine, we can instead spread it across many then do our operations in parallel and aggregate the results back together. We can formalize this paradigm into three steps</p>
<ul>
<li>Map: Split the data into sub-datasets and perform an operation on each entry in each sub-dataset thereby creating key-value pairs.</li>
<li>Shuffle: Merge the key-value pairs and sort them.</li>
<li>Reduce: Apply an operation on the associated values for each key.</li>
</ul>
<p>An excellent example is included at the bottom of this <a href="https://www.journaldev.com/8848/mapreduce-algorithm-example">link</a>. A similar paradigm that is implemented in the tidyverse is the <a href="https://www.jstatsoft.org/article/view/v040i01"><em>split-apply-combine</em></a> strategy.</p>
<p>The popular infrastructures for doing parallel computing with the MapReduce paradigm are Hadoop and Spark (think of Spark as an in-memory version of Hadoop). Spark can be more easily interfaced with than Hadoop through Python via <code>PySpark</code> and through R via <code>SparkR</code> (from Apache) or <code>sparklyr</code> (from RStudio). However, note that because Spark is natively implemented in Java and Scala, the overhead of serialization between R/Python to Java/Scala may be a time expensive operation.</p>
</div>
</div>
<div id="optimal-rstudio-set-up" class="section level2">
<h2><span class="header-section-number">7.8</span> Optimal RStudio set up</h2>
<p>Using the following settings will help ensure a smooth experience when working with big data. In RStudio, go to the “Tools” menu, then select “Global Options”. Under “General”:</p>
<p><strong>Workspace</strong></p>
<ul>
<li><strong>Uncheck</strong> Restore RData into workspace at startup</li>
<li>Save workspace to RData on exit – choose <strong>never</strong></li>
</ul>
<p><strong>History</strong></p>
<ul>
<li><strong>Uncheck</strong> Always save history</li>
</ul>
<p>Unfortunately RStudio often gets slow and/or freezes after hours working with big datasets. Sometimes it is much more efficient to just use Terminal / gitbash to run code and make updates in git.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="datawrangling.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="github.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["dcc-handbook.pdf", "dcc-handbook.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
